define("common/games/mp3",["jquery","utils","jquery.setup.environment","jquery.setup.environment.utils","common/jquery.datafunctions","common/games/gamecommon"],function(t,e,a,s,n,l){var o={},r="156950352,-2103486802",i=",1500719206,1570571613",d=",528536644,741286365",m=",982169050,222726850",u=",1347617716,-1857458609,997965532,779599105,1133504003,-2103486802,-1932771401,-2103486802";return o.statIds=r+i+d+m+u,o.LoadHomeScreen=function(){s.isOnline()&&o.GetCommunityStatsJS(),s.isOnline()&&s.isSignedIn()&&!s.isLocal()&&t("#homefeedPanel").find(".contentWrapper").fadeOut("slow"),l.LoadHomeScreen()},o.GetCommunityStatsJS=function(){var a={env:globals.rosEnvironment,title:globals.titleName,version:globals.RosTitleVersion,platformId:globals.platformId,rosTitleName:globals.titleName,statIds:o.statIds};e.WriteDebugLog("GetCommunityStatsJS","options",JSON.stringify(a)),t.ajax({type:"POST",url:e.getApiUrl("/api/"+globals.titleName+"/getcommunitystats"),services:["stats"],data:JSON.stringify(a),contentType:"application/json; charset=utf-8",dataType:"json",silentFail:!0,disableSlowMsg:!0,requestDescription:"GetCommunityStats",success:function(t){"undefined"!=typeof t&&null!=t&&void 0!=t.d&&t.Status?o.ProcessCommunityStats(t):o.GetCommunityStatsJSLocal()},error:function(t,a,s){e.WriteDebugLog("GetCommunityStatsJS","ERROR",s),e.WriteDebugLog("GetCommunityStatsJS","ERROR status",a),e.WriteDebugLog("GetCommunityStatsJS","ERROR responseText",t.responseText,e.logType.error,e.logController[globals.titleName]),o.GetCommunityStatsJSLocal()}})},o.GetCommunityStatsJSLocal=function(){e.WriteDebugLog("GetCommunityStatsJSLocal","",""),t.ajax({type:"GET",url:globals.baseAssetUrl+"xml/"+globals.titleName+"/CommunityStats.xml",dataType:"json",success:function(t){o.ProcessCommunityStats(t)},error:function(a,s,n){e.WriteDebugLog("GetCommunityStatsJSLocal","ERROR",n,e.logType.error,e.logController[globals.titleName]);try{t(this).stopPropagation()}catch(l){}}})},o.ProcessCommunityStats=function(a){if("undefined"!=typeof a&&null!=a&&"undefined"!=a.d&&(e.WriteDebugLog("ProcessCommunityStats","data.d",a.d),"ERROR"!=a.d.substring(0,5).toUpperCase())){var s=a.d.split(","),n=t("#homefeedPanel"),l=parseInt(s[0],10)+parseInt(s[1],10);n.find("#trendStatDWKills").html(e.addCommas(l)),n.find("#trendStatBulletsFired").html(o.formatTrendStat(e.addCommas(parseInt(s[2],10)+parseInt(s[3],10)))),n.find("#trendStatPillsPopped").html(o.formatTrendStat(e.addCommas(parseInt(s[4],10)+parseInt(s[5],10)))),n.find("#trendStatShootDodgeKills").html(o.formatTrendStat(e.addCommas(parseInt(s[6],10)+parseInt(s[7],10))));for(var r=0,i=8;i<s.length;i++)r+=parseInt(s[i],10);n.find("#trendStat2HKills").html(e.addCommas(r)),n.find("#globalStats").find("div.skull").removeClass("left right middle"),n.find("#globalStats").find("div.skull").addClass(l>1.2*r?"left":r>1.2*l?"right":"middle"),("undefined"!=typeof s[s.length-1]||null!=s[s.length-1])&&n.find("#statsDate").html(e.localizedDate(s[s.length-1],"LLL"))}},o.formatTrendStat=function(t){var e=t.split(",");if(e.length>1){for(var a="<span>"+e[0]+"</span>",s=1;s<e.length;s++)a+=","+e[s];return a}return t},o.LoadPlayerStats=function(a){e.WriteDebugLog("LoadPlayerStats","compareRockstarId",a),t.ajax({type:"GET",async:!1,url:globals.baseAssetUrl+"xml/"+globals.titleName+"/Stats"+globals.titlelang+".xml",dataType:"xml",success:function(e){var s=[];t(e).find("id").each(function(){s.push(t(this).text())}),o.GetPlayerStatsJS(e,s.join(","),globals.account.RockstarId,a),e=null,s=null},complete:function(t,a){e.ToggleCompareFriendElements(a)}})},o.GetPlayerStatsJS=function(a,l,o,r){var i=s.getCredsAsync();i.done(function(i){if(i&&i.Ticket){var d='{ "env":"'+globals.rosEnvironment+'","title":"'+globals.titleName+'","version":'+globals.RosTitleVersion+', "wsURL":"'+globals.wsURL+'","platformId":'+globals.platformId+',"statIds":"'+l+'","rockstarIds":"'+o+(void 0!=r?","+r:"")+'" }';e.WriteDebugLog("GetPlayerStatsJS","options",d);var m=s.GetAuthHeaderAsync(i.Ticket);m.done(function(i){t.ajax({type:"POST",url:e.getApiUrl("api/"+globals.titleName+"/getplayerstatsws"),services:["stats"],headers:i,data:d,contentType:"application/json; charset=utf-8",dataType:"xml",cache:!1,fatalError:n.ShowErrorModal,requestDescription:"GetPlayerStats",success:function(n,l){if("success"==l)if("true"==t(n).find("Status").text()){var i,d,m=2;null!=r&&void 0!=r&&(t("#statsPanel").addClass("compared"),m=3);var u=t(n).find("StatsRecord");u.each(function(){t(this).find("GamerHandle").text()=="SC "+o?i=t(this).find("Values").text().split(","):d=t(this).find("Values").text().split(",")});var c=[],p="";t(a).find("id").each(function(a){var s=t(this),n=s.parent().parent().find("header_name");n.length>0&&n.text()!=p&&(p=n.text(),c.length>0&&c.push("</tbody>"),c.push("<tbody id='"+n.nodeName+"' class='statgroup'><tr class='levelName statGroupHeader'><td colspan='"+m+"' class='levelName "+s.parent().parent()[0].nodeName+"'><span></span>"+p+"</td></tr>"));var l=s.text();if(""!=l.length){var o=void 0!=i&&void 0!=i[a]?i[a]:"0",r="",u=(s.parent()[0].nodeName.toUpperCase(),s.parent().find("type"));switch(u.text().toLowerCase()){case"duration":o="0"==o?"-":e.msToTime(o),t("#statsPanel").hasClass("compared")&&(r="<td class='col3'>"+(void 0!=d&&void 0!=d[a]&&"0"!=d[a]?e.msToTime(d[a]):"-")+"</td>");break;default:t("#statsPanel").hasClass("compared")&&(r="<td class='col3'>"+(void 0!=d&&void 0!=d[a]?d[a]:"0")+"</td>")}var g=s.parent().find("name");g.length>0&&c.push("<tr style='display:none' id='statId"+l+"' class='"+s.parent().parent()[0].nodeName+"'><td class='col1'>"+g.text()+"</td>"+r+"<td class='col2'>"+o+"</td></tr>")}}),c.length>0&&c.push("</tbody>"),t("#statstable").html(c.join("")),t("#statstable .statgroup").click(function(){var e=t(this);return e.find("tr.levelName.statGroupHeader").toggleClass("open"),e.children(":not(.statGroupHeader)").toggle("fast",function(){e.index()==e.parent().children().length-1&&s.resetScrollbar("#statsPanel")}),!1}),c=null,i=null,d=null}else e.WriteDebugLog("GetPlayerStatsJS","Status error",t(n).find("Error").text(),e.logType.error,e.logController[globals.titleName]);t("#checkName").fadeOut()},complete:function(){a=null,l=null,o=null,r=null,s.resetScrollbar("#statsContainer"),s.removeLoading("statsPanel"),t("#awardsLink2").removeClass("disabled")}})})}else s.removeLoading("statsPanel"),t("#statstable").html("<tr><td>"+s.getError("InternetAccess")+"</td></tr>")})},o});